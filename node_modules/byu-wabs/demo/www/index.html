<!--
  @license
    Copyright 2017 Brigham Young University

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/bootstrap.css">
    <style type="text/css">
        body {
            padding-bottom: 50px;
        }
        .output {
            background: #EEE;
            border-radius: 4px;
            padding: 10px;
            overflow: auto;
        }
        .row {
            margin-top: 40px;
        }
        .init-hidden {
            opacity: 0;
            transition: opacity 500ms;
        }
        .toast {
            position: fixed;
            top: 30px;
            left: 30px;
            transform: translateY(-60px);
            transition: all 300ms ease-in-out;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.error {
            border-color: #f5c6cb;
            background: #f8d7da;
            color: #721c24;
        }
        .toast.success {
            border-color: #c3e6cb;
            background: #d4edda;
            color: #155724;
        }

        #brownie-input {
            float: left;
            width: 150px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <noscript>
            <div class="alert alert-danger">This demo will not work without JavaScript enabled.</div>
        </noscript>

        <div id="error" class="init-hidden" style="margin-top: 50px">
            <div class="alert alert-danger" role="alert">
                <h3>The demo is not property set up.</h3>
                <h4>Requirements</h4>
                <ul>
                    <li>An active BYU OIT AWS account</li>
                    <li>Latest <a href="https://github.com/byu-oit/awslogin">awslogin</a> installed</li>
                    <li><a href="https://nodejs.org/en/" target="_blank">NodeJS</a> installed</li>
                    <li>
                        SSL installed. If not already installed you can use
                        <a href="https://wiki.openssl.org/index.php/Binaries" target="_blnak">OpenSSL</a>
                    </li>
                </ul>

                <h4>Setup</h4>
                <ol>
                    <li>Open a terminal window / command prompt.</li>
                    <li>Navigate to the demo directory.</li>
                    <li>Run the command <code>npm install</code></li>
                    <li>Run the command <code>awslogin</code></li>
                    <li>Select the <code>dev-oit-byu</code> account.</li>
                    <li>Run the command <code>npm start</code></li>
                    <li>Open a browser to <a href="http://localhost:3000">http://localhost:3000</a></li>
                </ol>
            </div>
        </div>

        <div class="row init-hidden success">
            <div class="col-sm">
                <h4>Current User</h4>
                <p>With JavaScript, use <code>byu.user</code> to get the currently logged in user.</p>
                <p>
                    <a class="btn btn-secondary" role="button" id="login" href="/login">Login</a>
                    <a class="btn btn-secondary" role="button" id="logout" href="/logout">Logout</a>
                </p>
            </div>
            <div class="col-sm output" id="user-json"></div>
        </div>

        <div class="row init-hidden success">
            <div class="col-sm">
                <div>
                    <h4>Client Grant Requests</h4>
                    <p>Client Grant requests must be handled on the server. They do no require the user to be authenticated.</p>
                    <p>This button will initiate a request to the Express server that will be proxied by the WABS
                        <code>clientGrantProxy</code> middleware will handle. The middleware will attach a client grant bearer token
                        to the authorization header of the request but otherwise send the request as it was received from the
                        browser.</p>

                    <p>
                        <button type="button" class="btn btn-secondary" id="clientGrant">Client Grant Proxy</button>
                    </p>
                </div>
            </div>
            <div class="col-sm output" id="client-grant-json"></div>
        </div>

        <div class="row init-hidden success">
            <div class="col-sm">
                <div>
                    <h4>Code Grant Request</h4>
                    <div id="auth-warning" class="alert alert-warning">You must be logged in for this work.</div>
                    <p>Code Grant requests required that the user be authenticated but allow the browser to make AJAX requests
                        directly to the API by adding an authorization header to the request with the available bearer token. An
                        authenticated user will have a bearer token that can be retrieved using <code>byu.auth.accessToken</code>.</p>
                    <p>This button will initiate a request that hits the API directly.</p>
                    <p>
                        <button type="button" class="btn btn-secondary" id="codeGrant">Code Grant</button>
                    </p>
                </div>
            </div>
            <div class="col-sm output" id="code-grant-json"></div>
        </div>

        <div class="row init-hidden success">
            <div class="col-sm">
                <div>
                    <h4>Brownie Interoperability</h4>
                    <p>With the BYU legacy frameworks browser tab (or window) specific data was maintained by
                        posting the tab specific data from one page to the next. Now we use window.sessionStorage
                        to maintain that same information, but to support backward compatibility with the legacy
                        frameworks, WABS can receive that posted brownie data and can post brownie data.</p>
                    <p>This from will set the brownie property <code>brownie_input</code> to the value specified in
                        the input field and will post brownie data back to this same page.</p>
                    <p>
                        <button type="button" class="btn btn-secondary" id="brownie-submit">Send Brownie</button>
                        <input type="text" class="form-control" id="brownie-input">
                    </p>
                </div>
            </div>
            <div class="col-sm output" id="brownie-data"></div>
        </div>

        <div class="row init-hidden success">
            <div class="col-sm">
                <div>
                    <h4>Access Token</h4>
                    <p>This is the code grant token associated with the user.</p>
                    <p>
                        <button type="button" class="btn btn-secondary" id="refresh-token">Refresh Token</button>
                    </p>
                </div>
            </div>
            <div class="col-sm output" id="token-data"></div>
        </div>
    </div>

    <script src="/axios.js"></script>
    <script src="/script.js"></script>
</body>
</html>
